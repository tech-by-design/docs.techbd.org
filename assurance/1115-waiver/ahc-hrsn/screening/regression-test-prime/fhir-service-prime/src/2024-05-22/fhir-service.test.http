# this file is for testing and verifying the  FHIR service with two api end points
# ------------------------------------------------------------------------
# * requires the `vscode-httpyac` Visual Studio Code extension
# * requires a `.env` file with HOST, PORT
# * this service has 2 endpoints /Bundle/$validate & /Bundle/

@hostName = {{$processEnv HOST}}

@contentType = application/json
@TECH_BD_FHIR_SERVICE_QE_IDENTIFIER = HEALTHELINK

### /metadata endpoint should return FHIR CapabilityStatement

GET {{hostName}}/metadata
Content-Type: {{contentType}}
?? status == 200
?? header content-type == text/html;charset=UTF-8
?? response.body  != null

< fhir-fixture-shinny-impl-guide-sample.json

### /Bundle/$validate should validate fhir-fixture-shinny-impl-guide-sample.json

POST {{hostName}}/Bundle/$validate HTTP/1.1 
Content-Type: {{contentType}}
Accept : application/fhir+json;charset=utf-8
TECH_BD_FHIR_SERVICE_QE_IDENTIFIER: {{TECH_BD_FHIR_SERVICE_QE_IDENTIFIER}}
?? status == 200
?? header content-type == application/fhir+json;charset=utf-8
?? response.body  != null
?? js response.parsedBody.OperationOutcome.validationResults[0].engine == HAPI
?? js response.parsedBody.OperationOutcome.resourceType == OperationOutcome
?? js response.parsedBody.OperationOutcome.validationResults[0].issues[0].severity == ERROR
?? js response.parsedBody.OperationOutcome.validationResults[0].issues[0].location.line == 1
?? js response.parsedBody.OperationOutcome.validationResults[0].issues[0].location.column == 6147
< fhir-fixture-shinny-impl-guide-sample.json


### /Bundle/$validate should validate fhir-fixture-unhappy-path-01.json

POST {{hostName}}/Bundle/$validate HTTP/1.1
Content-Type: {{contentType}}
Accept : application/fhir+json;charset=utf-8
TECH_BD_FHIR_SERVICE_QE_IDENTIFIER: {{TECH_BD_FHIR_SERVICE_QE_IDENTIFIER}}
?? status == 200
?? header content-type == application/fhir+json;charset=utf-8
?? response.body  != null
?? js response.parsedBody.OperationOutcome.validationResults[0].engine == HAPI
?? js response.parsedBody.OperationOutcome.resourceType == OperationOutcome
?? js response.parsedBody.OperationOutcome.validationResults[0].issues[0].severity == FATAL
?? js response.parsedBody.OperationOutcome.validationResults[0].issues[0].location.line == null
?? js response.parsedBody.OperationOutcome.validationResults[0].issues[0].location.column == null
< fhir-fixture-unhappy-path-01.json


### /Bundle/$validate should validate fhir-fixture-shinny-bronx-unhappy-path.json

POST {{hostName}}/Bundle/$validate HTTP/1.1
Content-Type: {{contentType}}
Accept : application/fhir+json;charset=utf-8
TECH_BD_FHIR_SERVICE_QE_IDENTIFIER: {{TECH_BD_FHIR_SERVICE_QE_IDENTIFIER}}
?? status == 200
?? header content-type == application/fhir+json;charset=utf-8
?? response.body  != null
?? js response.parsedBody.OperationOutcome.validationResults[0].engine == HAPI
?? js response.parsedBody.OperationOutcome.resourceType == OperationOutcome
?? js response.parsedBody.OperationOutcome.validationResults[0].issues[0].severity == ERROR
?? js response.parsedBody.OperationOutcome.validationResults[0].issues[0].location.line == 1
?? js response.parsedBody.OperationOutcome.validationResults[0].issues[0].location.column == 91

< fhir-fixture-shinny-bronx-unhappy-path.json

### /Bundle/$validate should validate fhir-fixture-shinny-healtheconnections-unhappy-path.json

POST {{hostName}}/Bundle/$validate HTTP/1.1
Content-Type: {{contentType}}
Accept : application/fhir+json;charset=utf-8
TECH_BD_FHIR_SERVICE_QE_IDENTIFIER: {{TECH_BD_FHIR_SERVICE_QE_IDENTIFIER}}
?? status == 200
?? header content-type == application/fhir+json;charset=utf-8
?? response.body  != null
?? js response.parsedBody.OperationOutcome.validationResults[0].engine == HAPI
?? js response.parsedBody.OperationOutcome.resourceType == OperationOutcome
?? js response.parsedBody.OperationOutcome.validationResults[0].issues[0].severity == FATAL
?? js response.parsedBody.OperationOutcome.validationResults[0].issues[0].location.line == null
?? js response.parsedBody.OperationOutcome.validationResults[0].issues[0].location.column == null
< fhir-fixture-shinny-healtheconnections-unhappy-path.json

### /Bundle should validate and submit fhir-fixture-shinny-impl-guide-sample.json as HEALTHeLINK

POST {{hostName}}/Bundle/?qe=HEALTHELINK HTTP/1.1
?? status != 201
?? response.body  != null

< fhir-fixture-shinny-impl-guide-sample.json  